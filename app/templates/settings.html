{% extends 'base.html' %}

{% block body %}

<div class="content my-5">

    <h1>Telegram WebApp Data</h1>
    <div class="data-container">
        <h2>User Information</h2>
        <pre id="user-data">Loading user data...</pre>
    </div>

    <div class="data-container hidden" id="chat-data-container">
        <h2>Chat Information</h2>
        <pre id="chat-data">No chat data available</pre>
    </div>

    <div class="data-container hidden" id="error-message">
        <h2 class="error">Error</h2>
        <pre id="error-data">No errors</pre>
    </div>

    <script>
        // Helper to safely display data
        function safeDisplay(data) {
            return data !== undefined && data !== null ? data : 'Not provided';
        }

        try {
            const tg = window.Telegram.WebApp;

            // Retrieve initDataUnsafe object
            const data = tg.initDataUnsafe;
            const user = data.user || null;
            const chat = data.chat || null;

            // Display user information
            const userDataElement = document.getElementById('user-data');
            if (user) {
                userDataElement.innerText = `
User ID: ${safeDisplay(user.id)}
First Name: ${safeDisplay(user.first_name)}
Last Name: ${safeDisplay(user.last_name)}
Username: ${safeDisplay(user.username)}
Language Code: ${safeDisplay(user.language_code)}
Is Premium: ${safeDisplay(user.is_premium)}
Profile Photo URL: ${safeDisplay(user.photo_url ? user.photo_url : "No photo URL")}
Allows PM: ${safeDisplay(user.allows_write_to_pm)}
                `.trim();
            } else {
                userDataElement.innerText = "No user data available.";
            }

            // Display chat information if available
            if (chat) {
                const chatDataContainer = document.getElementById('chat-data-container');
                const chatDataElement = document.getElementById('chat-data');
                chatDataContainer.classList.remove('hidden');

                chatDataElement.innerText = `
Chat ID: ${safeDisplay(chat.id)}
Chat Type: ${safeDisplay(chat.type)}
Chat Title: ${safeDisplay(chat.title)}
Chat Username: ${safeDisplay(chat.username)}
Chat Photo URL: ${safeDisplay(chat.photo_url ? chat.photo_url : "No photo URL")}
                `.trim();
            }

        } catch (error) {
            // Handle and display errors
            const errorContainer = document.getElementById('error-message');
            const errorDataElement = document.getElementById('error-data');
            errorContainer.classList.remove('hidden');
            errorDataElement.innerText = error.message;
        }
    </script>
    <!-- Balance -->
    <div class="telegram-card">
        <div class="telegram-card-header">
            Настройки
        </div>

        <div class="telegram-card-content">
            <form>
                <!-- Имя, Фамилия и Username -->
                <label class="text-muted">ОБЯЗАТЕЛЬНО</label>
                <input type="text" class="form-input" placeholder="Имя">
                    <div class="telecram-card-content mb-2 p-1">
                        Имя не может быть пустым!
                    </div>
                <label class="text-muted">НЕ ОБЯЗАТЕЛЬНО</label>
                <input type="text" class="form-input" placeholder="Фамилия">
                <label class="text-muted">КОРОТКОЕ ИМЯ ПОЛЬЗОВАТЕЛЯ</label>
                <input type="text" class="form-input" placeholder="@username">
                <div class="telecram-card-content mb-2 p-1">
                    Если короткое имя не показывается, значит оно не установлено у вас в телеграм!
                    Для корректной работы приложения, либо укажите его в телеграм, либо тут, заполнив поле. (Без @)
                </div>

               <div class="telegram-card-header">
                Язык и регион
               </div>
                <!-- Выпадающий список Язык -->
                <select class="form-select">
                    <option value="ru">Русский</option>
                    <option value="en">English</option>
                    <option value="de">Deutsch</option>
                </select>
                <!-- Выпадающий список Валюта -->
                <select class="form-select">
                    <option value="usd">USD</option>
                    <option value="eur">EUR</option>
                    <option value="rub">RUB</option>
                </select>

            </form>
        </div>

        <div class="telegram-card-footer">
            <!-- Можно добавить действия в футер -->
        </div>
    </div>

    <div class="telegram-card">
        <div class="telegram-card-header">
            Уведомления
           </div>

        <!-- Свайп-туглер с текстом -->
        <div class="checkbox-container">
            <span>Включить уведомления</span>
            <label>
                <div class="toggle-checkbox">
                    <input type="checkbox">
                    <span class="slider"></span>
                </div>
            </label>
        </div>
    </div>
    <!-- Всплывающий футер -->
<div class="floating-footer">
    <button class="btn btn-tg-theme btn-submit">Save</button>
</div>
</div>
{% endblock body %}